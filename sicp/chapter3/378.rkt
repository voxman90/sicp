#lang racket

#|
  Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ 3.78

                         ğ‘‘ğ‘¦â‚€                 ğ‘¦â‚€
                          â‡£                   â‡£
           dÂ²y      â”â”â”â”â”â”â”â”â”â”â”â”â”“  dy   â”â”â”â”â”â”â”â”â”â”â”â”â”“   y
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”ƒ integral  â” â”€â”€â”€Â·â”€â”€â”€â”¨ integral  â” â”€â”€â”€Â·â”€â”€â”€â–º
    â”‚               â”—â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚   â”—â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚
    â”‚                  â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚                   â”‚
    â”‚               â”Œâ”€â”€â”¨ scale: a â” â—„â”˜                   â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”’â—„â”˜  â”—â”â”â”â”â”â”â”â”â”â”â”›                     â”‚
    â””â”€â”¤ add       â”ƒ                                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”šâ—„â”  â”â”â”â”â”â”â”â”â”â”â”â”“                     â”‚
                    â””â”€â”€â”¨ scale: b â” â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”—â”â”â”â”â”â”â”â”â”â”â”›

  Ğ Ğ¸Ñ. 3.35. Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ°.

  Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ³Ğ¾Ğ¼Ğ¾Ğ³ĞµĞ½Ğ½Ñ‹Ñ… Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ñ‹Ñ… Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ…
  ÑƒÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ°

    ğ‘‘Â²ğ‘¦/ğ‘‘ğ‘¡Â² âˆ’ ğ‘ğ‘‘ğ‘¦/ğ‘‘ğ‘¡ âˆ’ ğ‘ğ‘¦ = 0

  Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº, Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ğ¹ ğ‘¦, Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ´Ğ°ĞµÑ‚ÑÑ ÑĞµÑ‚ÑŒÑ, ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰ĞµĞ¹ Ñ†Ğ¸ĞºĞ». Ğ­Ñ‚Ğ¾Ñ‚ Ñ†Ğ¸ĞºĞ» Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ°ĞµÑ‚ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ, Ñ‡Ñ‚Ğ¾
  Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ğ‘‘Â²ğ‘¦/ğ‘‘ğ‘¡Â² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ ğ‘¦ Ğ¸ ğ‘‘ğ‘¦/ğ‘‘ğ‘¡, Ğ° Ğ¾Ğ½Ğ¸ Ğ¾Ğ±Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ÑÑ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ğ‘‘Â²ğ‘¦/ğ‘‘ğ‘¡Â². Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°,
  ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ğ½Ğ°Ğ¼ Ñ…Ğ¾Ñ‚ĞµĞ»Ğ¾ÑÑŒ Ğ±Ñ‹ Ğ·Ğ°ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ° Ğ½Ğ° Ñ€Ğ¸Ñ. 3.35. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñƒ solve-2nd, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ²
  ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ±ĞµÑ€ĞµÑ‚ ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ ğ‘, ğ‘ Ğ¸ ğ‘‘ğ‘¡ Ğ¸ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ğ‘¦â‚€ Ğ¸ ğ‘‘ğ‘¦â‚€ Ğ´Ğ»Ñ ğ‘¦ Ğ¸ ğ‘‘ğ‘¦/ğ‘‘ğ‘¡, Ğ¸ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ´Ğ°ĞµÑ‚
  Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ ğ‘¦.
|#

(#%require rackunit
           racket/stream)

(define the-empty-stream empty-stream)

(define (stream-null? stream) (stream-empty? stream))

(define (stream-car stream) (stream-first stream))

(define (stream-cdr stream) (stream-rest stream))

(define (stream-ref s n)
  (if (= n 0)
      (stream-car s)
      (stream-ref (stream-cdr s) (- n 1))))

(define (stream-map proc . streams)
  (if (stream-null? (car streams))
      the-empty-stream
      (stream-cons
        (apply proc (map stream-car streams))
        (apply stream-map
               (cons proc (map stream-cdr streams))))))

(define (add-streams s1 s2)
  (stream-map + s1 s2))

(define (integral delayed-integrand initial-value dt)
  (stream-cons
    initial-value
    (let ((integrand (force delayed-integrand)))
      (if (stream-null? integrand)
          the-empty-stream
          (integral (delay (stream-cdr integrand))
                    (+ (* dt (stream-car integrand))
                        initial-value)
                    dt)))))

(define (scale-stream stream factor)
  (stream-map (lambda (x) (* x factor)) stream))

(define (solve-2nd a b y0 dy0 dt)
  (define y (integral (delay dy) y0 dt))
  (define dy (integral (delay ddy) dy0 dt))
  (define ddy (add-streams (scale-stream y b)
                           (scale-stream dy a)))
  y)

(check-equal? (stream-ref (solve-2nd 1 0 1 1 0.001) 1000) 2.716923932235896)
